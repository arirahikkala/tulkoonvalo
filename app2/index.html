<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <title>WebDALI</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <style type="text/css">
      .light-name { height: 1em; overflow-y: hidden; }
      .light-widget { margin: 1em auto 0 auto; }
      .light { float: left; width: 5em; overflow: hidden; margin: 0 5px 0 5px; text-align: center}
      .slider-collection { float: left; }
      .slider { float: left; margin: 1em }
      .slider { border-style:dashed; padding: 20px; border-width: 2px; border-color: solid black }
    </style>
    <script type="text/javascript" src="../lib/jqueryui/js/jquery-1.7.2.min.js"></script>
    <script type="text/javascript" src="../lib/underscore.js"></script>
    <script type="text/javascript" src="../lib/backbone.js"></script>
    <script type="text/javascript" src="../lib/jqueryui/js/jquery-ui-1.8.21.custom.min.js"></script>
    <script type="text/javascript" src="../lib/jstree/jquery.jstree.js"></script>
    <script type="text/javascript" src="slider.js"></script>
    <link rel="stylesheet" href="../lib/jqueryui/css/ui-lightness/jquery-ui-1.8.21.custom.css" />

  </head>
  <body>
    <div class="bar" id="sliders"></div> <br/> <br/>
    <div class="bar" id="sliders2"></div> <br /> <br />
    <input type="button" id="newslider" value="New slider" />
    <script type="text/javascript">
      var SliderCollection = Backbone.Collection.extend ({
	  model: Slider.Slider,
	  url: "../server2/sliders/",

	  initialize: function() {
	      //this.on ("add", function (m, c) { c.sync()});
	  }
      });

      var SliderCollectionView = Backbone.View.extend ({
	  tagName: "div",
	  className: "slider-collection",

	  initialize: function() {
	      var _this = this;
	      this.model.on ("add", function (m, c) { _this.$el.append (new Slider.SliderView ({model: m}).$el)});
	      this.render();
	  },

	  render: function() {
	      console.log ("rendered");
	      this.$el.empty();
	      var _this = this;
	      this.model.each (function (x) { _this.$el.append (new Slider.SliderView ({model: x}).$el)});
	  }
      });

      var Sliders = new SliderCollection();
      var SlidersView = new SliderCollectionView ({model: Sliders, el: $("#sliders")});
      Sliders.on ("add", function() { console.log ("added")});

      $("#newslider").bind ("click", function () { Sliders.add ({ value: 0 })});

      Sliders.fetch({ success: function() { SlidersView.render();}});

    </script>
  </body>

</html>
