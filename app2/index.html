<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <title>WebDALI</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <style type="text/css">
      .light-name { height: 1em; overflow-y: hidden; }
      .light-widget { margin: 1em auto 0 auto; }
      .light { float: left; width: 5em; overflow: hidden; margin: 0 5px 0 5px; text-align: center}
      .slider-collection { float: left; }
      .slider { float: left; margin: 1em; border: 2px solid red; padding: 25px; }
      .slider-widget { margin:auto; }
      .timer { width: 3em; font-size: 1em;}
      .timer-add { margin-top: 1em; }
      .onoff { margin-top: 1em;}

    </style>
    <script type="text/javascript" src="../lib/jqueryui/js/jquery-1.7.2.min.js"></script>
    <script type="text/javascript" src="../lib/underscore.js"></script>
    <script type="text/javascript" src="../lib/backbone.js"></script>
    <script type="text/javascript" src="../lib/jqueryui/js/jquery-ui-1.8.21.custom.min.js"></script>
    <script type="text/javascript" src="../lib/jstree/jquery.jstree.js"></script>
    <script type="text/javascript" src="slider.js"></script>
    <link rel="stylesheet" href="../lib/jqueryui/css/ui-lightness/jquery-ui-1.8.21.custom.css" />

  </head>
  <body>
    <div class="bar" id="sliders"></div> <br/> <br/>
    <div class="slider" id="exampleslider"></div> <br /> <br />
    <input type="button" id="newslider" value="New slider" />
    <script type="text/javascript">
      var SliderCollection = Backbone.Collection.extend ({
	  model: Slider.Slider,
	  lightIds : [], // TODO: Proper way of doing things?
	  
	  url: function() {
	  	return "../server2/data/"+this.lightIds
		},
		
	  initialize: function() {
	      //this.on ("add", function (m, c) { c.sync()});
	  },
	  
	  newSlider: function(lightList) {
	  	console.log("NEWSDLIDER", this);
		  this.lightIds = lightList;
		  this.fetch({ success: function() { console.log("Fetch done!"); } });
	  },
	  
	  parse: function(response) {
	  	// TODO: child button, element insert
	  	for (var i=0; i< response.length; i++) {
	  		curLight = response[i][0];
		  	this.add ({ id: curLight["permament_id"], header: curLight["name"], 
		  	value: curLight["current_level"], children: response[i][1], collection: this });
		  }
	  },
	  
      });

      var SliderCollectionView = Backbone.View.extend ({
	  tagName: "div",
	  className: "slider-collection",

	  initialize: function() {
	      var _this = this;
	      this.model.on ("add", function (m, c) { _this.$el.append (new Slider.SliderView ({model: m}).$el)});
	      this.render();
	  },

	  render: function() {
	      console.log ("rendered");
	      this.$el.empty();
	      var _this = this;
	      this.model.each (function (x) { _this.$el.append (new Slider.SliderView ({model: x}).$el)});
	  }
      });
			var Foo = new Slider.Slider();
			Foo.startTimer();
			var fooView = new Slider.SliderView({model: Foo, el: $("#exampleslider")});
			
      var Sliders = new SliderCollection();
      var SlidersView = new SliderCollectionView ({ model: Sliders, el: $("#sliders") });
      
      Sliders.on ("add", function() { console.log ("added")});
			
      //$("#newslider").bind ("click", function () { Sliders.add ({ value: 0 })});
			$("#newslider").bind ("click", function () { Sliders.newSlider([6]); });
			
			Sliders.newSlider([6,4]);
    </script>
  </body>

</html>
