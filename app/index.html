<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <title>WebDALI</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <style type="text/css">
      .light-widget { margin: 10px 10px 15px 10px; }
    </style>
    <script type="text/javascript" src="../lib/jqueryui/js/jquery-1.7.2.min.js"></script>
    <script type="text/javascript" src="../lib/underscore.js"></script>
    <script type="text/javascript" src="../lib/backbone.js"></script>
    <script type="text/javascript" src="../lib/jqueryui/js/jquery-ui-1.8.21.custom.min.js"></script>
    <script type="text/javascript" src="../lib/jstree/jquery.jstree.js"></script>
    <script type="text/javascript" src="../lib/jquery.idTabs.min.js"></script>
    <script type="text/javascript" src="light.js"></script>
    <script type="text/javascript" src="program.js"></script>
    <script type="text/javascript" src="programline.js"></script>
    <script type="text/javascript" src="programlist.js"></script>
    <link rel="stylesheet" href="../lib/jqueryui/css/ui-lightness/jquery-ui-1.8.21.custom.css" />
    <link rel="stylesheet" href="../lib/idTabStyle.css" />

  </head>
  <body>
    <div id="programMenu"></div>
    <div id="programList"></div>
    <script type="text/javascript">
      // todo: truncate document content when switching view! (with #("body").empty();)
      // put the stuff at the beginning of controlsView into a function of its own as it's going to be shared
      Backbone.emulateHTTP = true;
      var Programs = new ProgramList.ProgramList;

      var AppRouter = Backbone.Router.extend ({
	  routes: {
	      "programs": "programsView",
	      "controls": "controlsView",
	      "test": "testView",
	      "help": "helpView",
	      "groups": "groupsView",
	      "": "controlsView"
	  },

	  programsView: function () {
//	      var ProgramMenu = new ProgramList.SingleChoiceMenu({ model: Programs, el: $("#programMenu") });


	      this.topOfMainView("programs");
	      $("#programs").append("<br/>");
	      $("#programs").append("<div id='lightList' class='lights'></div>");
	      $("#programs").append("<div id='programsContainer' class='programs'></div>");
	      $("#programsContainer").append("<div id='programList'></div>");
	      $("#programsContainer").append ("<div id='createProgram' class='eiVierekkain'</div>");
	      $("#programs").append ("<div id='deleteProgram' class='eiVierekkain'></div>");
	      $("#createProgram").append("<hr>");
	      $("#createProgram").append("<input type='text' value='Name...' name='programName'/>");
	      $("#createProgram").append("<input type='button' value='Add' name='cProgram'/>");
	      $("#deleteProgram").append("<input type='button' value='Delete program' name='dProgram'/>");
	      $("#programs").append("<div id='programSetup' class='eiVierekkain'</div>");


	      $.jstree._themes="../lib/jstree/themes/";
	      var lightTree = $("#lightList").jstree ({
		  "json_data": {
		      "ajax": {
			  "url": "../server/lights"
		      }
		  },

		  "ui" : {
		      "select_limit" : 1,
		  },

		  "checkbox": {
		      "two_state": "true"
		  },
		  "plugins": ["themes", "json_data", "checkbox", "ui"]});



	     $.jstree._themes="../lib/jstree/themes/";
	      var lightTree = $("#programList").jstree ({
		  "json_data": {
		      "ajax": {
			  "url": "../server/lights"
		      }
		  },

		  "ui" : {
		      "select_limit" : 1,
		  },

		  "checkbox": {
		      "two_state": "true"
		  },
		  "plugins": ["themes", "json_data", "ui"]});

	  },

	  topOfMainView: function(page) {
	      $("body").empty();
	      $("body").append ("<div id='container'></div>");
	      $("#container").append ("<div id='usual' class='usual'></div>");
	      $("#usual").append ("<ul class='testi'>");

  	      $("#usual ul").append ("<li><a href='#controls' " + (page == "controls" ? "class='selected'" : "") + ">Controls</a></li>");
	      $("#usual ul").append ("<li><a href='#groups' " + (page == "groups" ? "class='selected'" : "") + ">Groups</a></li>");
	      $("#usual ul").append ("<li><a href='#programs' " + (page == "programs" ? "class='selected'" : "") + ">Programs</a></li>");
	      $("#usual ul").append ("<li><a href='#help' " + (page == "help" ? "class='selected'" : "") + ">Help</a></li>");

	      $("#usual").append ("<div id='controls' class='divit'> Controls<br></div>");
	      $("#usual").append ("<div id='groups' class='divit'>Groups<br></div>");
	      $("#usual").append ("<div id='programs' class='divit'> Programs<br></div>");
	      $("#usual").append ("<div id='help' class='divit'> Help page</div>");

	      $("#usual ul").idTabs(true);

	  },

	  makeLightTree: function (div) {
	  		$.jstree._themes="../lib/jstree/themes/";
	      var testTree = $(div).jstree ({
		  "json_data": {
		      "ajax": {
			  "url": "../server/lights"
		      }
		  },

		  "ui" : {
		      "select_limit" : 1,
		  },

		  "checkbox": {
		      "two_state": "true"
		  },
		  "plugins": ["themes", "json_data", "checkbox", "ui"]});


	  },

	  controlsView: function() {
	      this.topOfMainView("controls");
	      
	      $("#controls").append ("<br/>");
	      $("#controls").append ("<div class='lights' id='lightList';></div>");
	      
	      //var lightsMenu = new ProgramList.SingleChoiceMenu({ model: Programs, el: $("#lights") });

	      this.makeLightTree("#lightList");

	      $("#controls").append ("<div class='programs' id='programsList';></div>");
	      $("#controls").append ("<div id='program' class='eiVierekkain';>Programs</div>");
	      $("#controls").append ("<div id='htmlEmbedded' class='eiVierekkain';>HTMLEMBEDDED</div>");
	      //$("#controls").append ("<br style='clear: left;'/>");

	      $("#programsList").append("<div id='bar'></div>");
	      $("#programsList").append("<div id='foo'></div>");

	      //var ProgramMenu = new ProgramList.SingleChoiceMenu({ model: Programs, el: $("#bar") });

	      $.jstree._themes="../lib/jstree/themes/";
	      var programTree = $("#foo").jstree ({
		  "json_data": {
		      "ajax": {
			  "url": "../server/lights"
		      }
		  },

		  "ui" : {
		      "select_limit" : 1,
		  },

		  "checkbox": {
		      "two_state": "false"
		  },
		  "plugins": ["themes", "json_data", "checkbox", "ui"]});



	  },

	  groupsView: function () {
	      this.topOfMainView("groups");

	      $("#groups").append ("<br/>");
	      $("#groups").append ("<div id='groupContainer' class='programs'></div>");
	      $("#groupContainer").append ("<div id='bigLights'></div>");
	      $("#groupContainer").append ("<div id='groupAdd' class='eiVierekkain'></div>");
	      $("#groups").append ("<div id='groupRemove' class='eiVierekkain'></div>");

	      $("#groupAdd").append("<hr class='groupsSettings'><br/>");
	      $("#groupAdd").append("<input type='text' value='Name...' name='gName'/ class='groupsSettings'>");
	      $("#groupAdd").append("<input type='submit' value='Add' name='sGroup'/><br/><br/>");

	      $("#groupRemove").append("<input type='submit' value='Remove group' name='rGroup' class='groupsSettings'/>");

	      $.jstree._themes="../lib/jstree/themes/";
	      var programTree = $("#bigLights").jstree ({
		  "json_data": {
		      "ajax": {
			  "url": "../server/lights"
		      }
		  },

		  "ui" : {
		      "select_limit" : 1,
		  },

		  "checkbox": {
		      "two_state": "false"
		  },
		  "plugins": ["themes", "json_data", "dnd", "ui"]});


	  },

	  helpView: function () {
	  	  this.topOfMainView("help");

	  	  $("#help").append("<br/>");
	  	  $("#help").append("<br/>");
	  	  $("#help").append("Please select an PDF file if you need any assistance: <br/><br/>");
	  	  $("#help").append("<a href='../doc/controlsHelp.pdf'>Control page's help PDF File</a><br/>");
	  	  $("#help").append("<a href='../doc/groupHelp.pdf'>Group page's help PDF File</a><br/>");
	  	  $("#help").append("<a href='../doc/programHelp.pdf'>Program page's help PDF File</a><br/>");
	  },

	  testView: function () {
	      $("body").append ("<div id='testLight'></div>");

	      var LightCollectionTest = Backbone.Collection.extend ({
		  model: Light.Light,
		  url: "../server/lightsFlat"
	      });
	      
	      var Lights = new LightCollectionTest;

	      var ProgramObj = new ProgramLine.ProgramLine({name: "ohjelma"});
	      var ProgramView = new ProgramLine.ProgramLineView ({el: $("#testLight"), model: ProgramObj});
	      
	      Lights.fetch( { success: function (lights, response) { lights.each (function (light) {ProgramView.addLight (light)})}});
	  }
	  
      });
      var appRouter = new AppRouter;
      Backbone.history.start();
      /*

       */

    </script>
  </body>
</html>
